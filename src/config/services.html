<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Services Overview</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="../css/styles.css" rel="stylesheet">
    <link href="../css/full.css" rel="stylesheet" type="text/css" />
    <style>
        /* Global Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            color: #333;
            overflow-y: auto;
        }

        header {
            background-color: #343a40;
            color: #060606;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        header .logo img {
            width: 50px;
        }

        header .nav-menu a {
            color: #ffffff;
            text-decoration: none;
            font-weight: 500;
            padding: 10px;
            border-radius: 8px;
            transition: background-color 0.3s;
        }

        header .nav-menu a:hover {
            background-color: #6b63ff;
        }

        main {
            flex: 1;
            padding: 40px 20px;
            background-color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .container {
            width: 100%;
            max-width: 900px;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.05);
        }

        h1 {
            text-align: center;
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 30px;
            color: #333;
        }

        .service-list {
            display: flex;
            /* Changed to flex for centering */
            flex-wrap: wrap;
            /* Allow wrapping of items */
            justify-content: center;
            /* Center the items */
            gap: 20px;
        }

        .service-item {
            width: 240px;
            /* Reduced width for smaller cards */
            padding: 15px;
            /* Adjusted padding */
            background: #f8f9fa;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.2s;
        }

        .service-item:hover {
            transform: translateY(-5px);
        }

        .service-item h3 {
            margin: 10px 0;
            font-size: 1.2rem;
            font-weight: 500;
            color: #333;
        }

        .status {
            font-size: 0.9rem;
            font-weight: 600;
            padding: 5px 15px;
            border-radius: 20px;
            text-transform: uppercase;
        }

        .status.running {
            background-color: #34d399;
            color: #fff;
        }

        .status.not-running {
            background-color: #ef4444;
            color: #fff;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .action-button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            color: white;
            transition: background-color 0.3s;
        }

        .action-button.start-button {
            background-color: #22c55e;
        }

        .action-button.start-button:hover {
            background-color: #16a34a;
        }

        .action-button.stop-button {
            background-color: #ef4444;
        }

        .action-button.stop-button:hover {
            background-color: #dc2626;
        }

        .no-services {
            text-align: center;
            color: #6c757d;
            font-size: 1rem;
            margin-top: 20px;
        }


        @media(max-width: 600px) {
            .container {
                padding: 10px;
            }

            .service-item {
                padding: 15px;
            }

            h1 {
                font-size: 1.5rem;
            }
        }

        .navbar-end .btn-circle svg {
            width: 24px;
            height: 24px;
            color: white;
        }

        .navbar-end .btn-circle:hover svg {
            color: #e2e8f0;
        }

        .navbar-end .menu {
            display: flex;
            align-items: center;
        }

        .navbar-end .btn-circle.btn-lg {
            width: 3rem;
            height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .navbar-end .btn-circle.btn-lg svg {
            margin-top: -5px;
            width: 25px;
            height: 25px;
            color: white;
        }

        .navbar-end .btn-circle.btn-lg:hover svg {
            color: #e2e8f0;
        }
    </style>
</head>

<body>
    <header class="navbar bg-base-100">
        <div class="navbar-start">
            <a href="/" class="btn btn-ghost text-xl"><img class="header__logo me-2" src="../assets/auzoneLogo.svg"
                    alt=""></a>
        </div>
        <div class="navbar-center">
            <span class="text-xl">Services Status</span>
        </div>
        <div class="navbar-end">
            <ul class="menu menu-horizontal px-1">

                </li>
                <a href="/settings" class="btn btn-ghost btn-circle btn-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-8 h-8">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </a>
            </ul>
        </div>
    </header>

    <main>
        <div class="container">
            <h1></h1>
            <ul id="service-list" class="service-list"></ul>
            <div id="error-message" class="no-services"></div>
        </div>
    </main>

    <script>
        const allowedServices = [
            'navsat', 'recorder', 'imu', 'radarpub',
            'camera', 'segment', 'detect', 'zenohd'
        ];

        async function fetchServices() {
            try {
                const response = await fetch('/config/service/status', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const services = await response.json();
                displayServices(services);
            } catch (error) {
                console.error('Error fetching services:', error);
                displayError('Error fetching services. Please try again later.');
            }
        }

        function displayServices(services) {
            const serviceList = document.getElementById('service-list');
            const errorMessage = document.getElementById('error-message');
            serviceList.innerHTML = ''; // Clear previous entries
            errorMessage.textContent = ''; // Clear previous error message

            // Filter services based on allowed keywords
            const filteredServices = services.filter(service =>
                allowedServices.some(keyword => service.name.toLowerCase().includes(keyword))
            );

            if (filteredServices.length > 0) {
                filteredServices.forEach(service => {
                    const listItem = document.createElement('li');
                    listItem.className = 'service-item';
                    // Remove '.service' and capitalize the first letter
                    const serviceName = service.name.replace('.service', '');
                    const formattedServiceName = serviceName.charAt(0).toUpperCase() + serviceName.slice(1);
                    listItem.innerHTML = `
                        <h3>${formattedServiceName}</h3>
                        <span class="status ${service.status === 'running' ? 'running' : 'not-running'}">
                            ${service.status === 'running' ? 'Running' : 'Not Running'}
                        </span>
                        <div class="action-buttons">
                            <button class="action-button start-button" onclick="updateService('${service.name}', 'start')">Start</button>
                            <button class="action-button stop-button" onclick="updateService('${service.name}', 'stop')">Stop</button>
                        </div>
                    `;
                    serviceList.appendChild(listItem);
                });
            } else {
                // Handle the case where no services match the filter
                errorMessage.textContent = 'No matching services found.';
            }
        }

        function displayError(message) {
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = message;
        }

        async function updateService(serviceName, action) {
            try {
                const response = await fetch('/config/services/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        service: serviceName,
                        action: action
                    })
                });
                if (response.ok) {
                    alert(`Service ${action === 'start' ? 'started' : 'stopped'} successfully.`);
                    fetchServices(); // Refresh the service list
                } else {
                    alert('Error updating service.');
                }
            } catch (error) {
                console.error('Error updating service:', error);
                alert('Error updating service. Please try again later.');
            }
        }

        window.addEventListener('load', fetchServices);
    </script>
</body>

</html>